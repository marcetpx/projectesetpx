<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJECTES ETPX - Firebase</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --color-primary: #192b54;
            --color-primary-light: #2a3f6f;
            --color-secondary: #9DB51F;
            --color-secondary-light: #b0d025;
            --color-white: #ffffff;
            --color-dark: #1a1a1a;
            --color-surface: #ffffff;
            --color-background: #f8f9fa;
            --color-on-surface: #333333;
            --spacing-xs: 1rem;
            --spacing-sm: 1.5rem;
            --spacing-md: 2rem;
            --spacing-lg: 3rem;
            --spacing-xl: 5rem;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 3px 6px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.15);
            --shadow-xl: 0 15px 25px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 62.5%;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
            line-height: 1.6;
            background: var(--color-background);
            color: var(--color-on-surface);
        }

        /* Navegaci√≥ */
        .nav-bar {
            position: fixed;
            top: 0;
            width: 100%;
            background: var(--color-primary);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            padding: 1.5rem 5%;
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            color: var(--color-white);
            font-size: 2.2rem;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            color: var(--color-white);
            text-decoration: none;
            font-size: 1.5rem;
            font-weight: 500;
            text-transform: uppercase;
            padding: 0.8rem 1.6rem;
        }

        /* Botons Acci√≥ */
        .add-btn,
        .delete-btn {
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            margin-left: 1rem;
            color: white;
        }

        .add-btn {
            background: var(--color-secondary);
            font-size: 2.4rem;
        }

        .delete-btn {
            background: #d9534f;
            font-size: 1.6rem;
        }

        .add-btn:hover,
        .delete-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        /* Estructura */
        .breadcrumb {
            margin-top: 100px;
            padding: 1.5rem 5%;
            background: var(--color-surface);
            box-shadow: var(--shadow-sm);
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-lg) 5%;
            min-height: calc(100vh - 300px);
        }

        .hidden {
            display: none !important;
        }

        /* Cards i Grid */
        .home-view {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .cicle-card {
            position: relative;
            height: 350px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            background: var(--color-surface);
        }

        .cicle-card-bg {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            transition: 0.3s;
        }

        .cicle-card:hover .cicle-card-bg {
            filter: grayscale(100%);
        }

        .cicle-card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.2), rgba(25, 43, 84, 0.85));
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .cicle-card h2 {
            color: white;
            font-size: 2.4rem;
            text-align: center;
            text-transform: uppercase;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Detall */
        .detail-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            background: var(--color-surface);
        }

        .detail-header h1 {
            font-size: 3.6rem;
            color: var(--color-primary);
            text-transform: uppercase;
            border-bottom: 4px solid var(--color-secondary);
            display: inline-block;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2.5rem;
            margin-bottom: var(--spacing-xl);
        }

        .project-card {
            height: 300px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .project-info {
            background: var(--color-surface);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--spacing-lg);
        }

        .project-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: var(--spacing-md);
        }

        .project-image {
            width: 100%;
            height: 250px;
            background-size: cover;
            background-position: center;
        }

        /* Modals */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            padding: 3rem;
            border-radius: 4px;
            position: relative;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .submit-btn {
            width: 100%;
            padding: 1.2rem;
            background: var(--color-primary);
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
        }

        .project-info h2 {
            text-transform: uppercase;
            margin-bottom: 30px;
            color: var(--color-primary);
            font-weight: 700;
        }

        .footer {
            background: var(--color-primary);
            color: white;
            padding: var(--spacing-lg) 5%;
            text-align: center;
        }

        @media (max-width: 768px) {
            .project-content {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }
        }
    </style>
</head>

<body>
    <nav class="nav-bar">
        <div class="nav-content">
            <div class="brand" onclick="router.navigateTo('home')"><span>üéì</span> ETP XAVIER</div>
            <ul class="nav-links">
                <li><a href="#" onclick="router.navigateTo('home')">PROJECTES</a></li>
                <li><button class="add-btn" onclick="modalController.open()">+</button></li>
                <li><button class="delete-btn" onclick="deleteController.open()"><i class="fas fa-trash"></i></button>
                </li>
            </ul>
        </div>
    </nav>

    <div class="breadcrumb" id="breadcrumb">
        <div class="breadcrumb-content" style="max-width: 1400px; margin: 0 auto; font-size: 1.4rem;">
            <a href="#" onclick="router.navigateTo('home')"
                style="text-decoration:none; color: var(--color-primary);">Inici</a>
            <span id="breadcrumb-separator" class="hidden"> ‚Ä∫ </span>
            <span id="breadcrumb-current"></span>
        </div>
    </div>

    <main class="main-container" id="app">
        <div style="text-align:center; padding: 50px;">Carregant base de dades...</div>
    </main>

    <footer class="footer">
        <p>ETP XAVIER - Projectes Educatius 2025</p>
    </footer>

    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h2>Acc√©s Administrador</h2>
            <form onsubmit="authController.login(event)">
                <div class="form-group"><label>Usuari</label><input type="text" id="username" required></div>
                <div class="form-group"><label>Contrasenya</label><input type="password" id="password" required></div>
                <p id="login-error" style="color:red; display:none;">Dades incorrectes</p>
                <button type="submit" class="submit-btn">Entrar</button>
                <button type="button" onclick="authController.close()"
                    style="margin-top:10px; background:none; border:none; cursor:pointer; width:100%;">Cancel¬∑lar</button>
            </form>
        </div>
    </div>

    <div id="project-modal" class="modal">
        <div class="modal-content">
            <h2>Nou Projecte</h2>
            <form onsubmit="modalController.submit(event)">
                <div class="form-group"><label>Especialitat</label><select id="category-select" required></select></div>
                <div class="form-group"><label>T√≠tol</label><input type="text" id="project-title" required></div>
                <div class="form-group"><label>URL Imatge</label><input type="url" id="project-image" required></div>
                <div class="form-group"><label>Descripci√≥</label><textarea id="project-desc" required></textarea></div>
                <button type="submit" class="submit-btn">Guardar</button>
                <button type="button" onclick="modalController.close()"
                    style="margin-top:10px; background:none; border:none; cursor:pointer; width:100%;">Tancar</button>
            </form>
        </div>
    </div>

    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <h2 style="color:#d9534f">Esborrar Projecte</h2>
            <form onsubmit="deleteController.submit(event)">
                <div class="form-group"><label>Especialitat</label><select id="delete-category-select"
                        onchange="deleteController.populateProjects()" required></select></div>
                <div class="form-group"><label>Projecte</label><select id="delete-project-select" required></select>
                </div>
                <button type="submit" class="submit-btn" style="background:#d9534f">Confirmar Eliminaci√≥</button>
                <button type="button" onclick="deleteController.close()"
                    style="margin-top:10px; background:none; border:none; cursor:pointer; width:100%;">Tancar</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDATUfe_tfKT8OiuvSj70R2kVw45I8BXds",
            authDomain: "projectesetpx.firebaseapp.com",
            databaseURL: "https://projectesetpx-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "projectesetpx",
            storageBucket: "projectesetpx.firebasestorage.app",
            messagingSenderId: "157521141762",
            appId: "1:157521141762:web:59d681379ea635ddc3471b",
            measurementId: "G-K83ZM6X6NW"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let projectsData = {};
        const authState = { isLoggedIn: false, user: "admin", pass: "Etpx$2025", pendingAction: null };

        // ROUTER
        const router = {
            currentView: 'home',
            currentCicle: null,
            navigateTo(view, cicleId = null) {
                this.currentView = view;
                this.currentCicle = cicleId;
                const sep = document.getElementById('breadcrumb-separator');
                const curr = document.getElementById('breadcrumb-current');

                if (view === 'home') {
                    this.renderHome();
                    sep.classList.add('hidden');
                    curr.classList.add('hidden');
                } else {
                    this.renderDetail(cicleId);
                    sep.classList.remove('hidden');
                    curr.textContent = projectsData[cicleId]?.title;
                    curr.classList.remove('hidden');
                }
                window.scrollTo(0, 0);
            },
            renderHome() {
                const app = document.getElementById('app');
                const html = Object.keys(projectsData).map(id => `
                    <div class="cicle-card" onclick="router.navigateTo('detail', '${id}')">
                        <div class="cicle-card-bg" style="background-image: url('${projectsData[id].image}')"></div>
                        <div class="cicle-card-overlay"><h2>${projectsData[id].title}</h2></div>
                    </div>
                `).join('');
                app.innerHTML = `<div class="home-view">${html}</div>`;
            },
            renderDetail(id) {
                const app = document.getElementById('app');
                const data = projectsData[id];
                if (!data) return;

                const projectsHtml = data.projects?.map(p => `
                    <div class="project-info">
                        <h2>${p.title}</h2>
                        <div class="project-content">
                            <div class="project-image" style="background-image: url('${p.image}')"></div>
                            <div>${p.content.map(text => `<p style="margin-bottom:10px">${text}</p>`).join('')}</div>
                        </div>
                    </div>
                `).join('') || '<p>No hi ha projectes.</p>';

                app.innerHTML = `
                    <button onclick="router.navigateTo('home')" style="margin-bottom:20px; padding:10px; cursor:pointer;">‚Üê Tornar</button>
                    <div class="detail-header"><h1>${data.title}</h1></div>
                    <div>${projectsHtml}</div>
                `;
            }
        };

        // AUTH
        const authController = {
            open() { document.getElementById('login-modal').classList.add('active'); },
            close() { document.getElementById('login-modal').classList.remove('active'); },
            login(e) {
                e.preventDefault();
                if (document.getElementById('username').value === authState.user && document.getElementById('password').value === authState.pass) {
                    authState.isLoggedIn = true;
                    this.close();
                    if (authState.pendingAction === 'add') modalController.open();
                    if (authState.pendingAction === 'delete') deleteController.open();
                } else {
                    document.getElementById('login-error').style.display = 'block';
                }
            }
        };

        // MODAL ADD
        const modalController = {
            open() {
                if (!authState.isLoggedIn) { authState.pendingAction = 'add'; authController.open(); return; }
                const sel = document.getElementById('category-select');
                sel.innerHTML = Object.keys(projectsData).map(k => `<option value="${k}">${projectsData[k].title}</option>`).join('');
                document.getElementById('project-modal').classList.add('active');
            },
            close() { document.getElementById('project-modal').classList.remove('active'); },
            submit(e) {
                e.preventDefault();
                const cat = document.getElementById('category-select').value;
                const newP = {
                    id: Date.now().toString(),
                    title: document.getElementById('project-title').value,
                    image: document.getElementById('project-image').value,
                    content: document.getElementById('project-desc').value.split('\n')
                };
                if (!projectsData[cat].projects) projectsData[cat].projects = [];
                projectsData[cat].projects.push(newP);
                db.ref('projects').set(projectsData).then(() => {
                    this.close();
                    router.navigateTo('detail', cat);
                });
            }
        };

        // MODAL DELETE
        const deleteController = {
            open() {
                if (!authState.isLoggedIn) { authState.pendingAction = 'delete'; authController.open(); return; }
                const sel = document.getElementById('delete-category-select');
                sel.innerHTML = Object.keys(projectsData).map(k => `<option value="${k}">${projectsData[k].title}</option>`).join('');
                this.populateProjects();
                document.getElementById('delete-modal').classList.add('active');
            },
            close() { document.getElementById('delete-modal').classList.remove('active'); },
            populateProjects() {
                const cat = document.getElementById('delete-category-select').value;
                const selP = document.getElementById('delete-project-select');
                const projs = projectsData[cat].projects || [];
                selP.innerHTML = projs.map((p, i) => `<option value="${i}">${p.title}</option>`).join('') || '<option disabled>Cap projecte</option>';
            },
            submit(e) {
                e.preventDefault();
                const cat = document.getElementById('delete-category-select').value;
                const idx = document.getElementById('delete-project-select').value;
                if (confirm("Segur que vols esborrar-lo?")) {
                    projectsData[cat].projects.splice(idx, 1);
                    db.ref('projects').set(projectsData).then(() => this.close());
                }
            }
        };

        // Dades inicials per si la base de dades est√† buida
        const initialData = {
            comerc: { title: "COMER√á INTERNACIONAL", image: "https://via.placeholder.com/800x600?text=Comerc", projects: [] },
            adifin: { title: "ADMINISTRACI√ì I FINANCES", image: "https://via.placeholder.com/800x600?text=Adifin", projects: [] },
            gestio: { title: "GESTIO ADMINISTRATIVA", image: "https://via.placeholder.com/800x600?text=Gestio", projects: [] },
            cai: { title: "CAI", image: "https://via.placeholder.com/800x600?text=CAI", projects: [] },
            farmacia: { title: "FARM√ÄCIA", image: "https://via.placeholder.com/800x600?text=Farmacia", projects: [] },
            dietetica: { title: "DIET√àTICA", image: "https://via.placeholder.com/800x600?text=Dietetica", projects: [] },
            infantil: { title: "EDUCACI√ì INFANTIL", image: "https://via.placeholder.com/800x600?text=Infantil", projects: [] },
            daw: { title: "DESENVOLUPAMENT APPS WEB", image: "https://via.placeholder.com/800x600?text=DAW", projects: [] },
            batxi: { title: "BATXILLERAT", image: "https://via.placeholder.com/800x600?text=Batxillerat", projects: [] }
        };

        // INICIALITZACI√ì MODIFICADA
        db.ref('projects').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                projectsData = data;
                if (router.currentView === 'home') router.renderHome();
                else router.renderDetail(router.currentCicle);
            } else {
                // SI LA DB EST√Ä BUIDA, PUJEM LES DADES INICIALS
                console.log("Base de dades buida. Inicialitzant...");
                db.ref('projects').set(initialData);
            }
        });
    </script>
</body>

</html>